{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1 class="my-4">–í—Å–µ –∏–≥—Ä–æ–∫–∏</h1>
    
    <div class="row">
        {% for player in players %}
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5>–ò–≥—Ä–æ–∫ ‚Ññ{{ player.id }}</h5>
                </div>
                <div class="card-body">
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="mb-3">
                        <p>ü™™ <strong>–ò–º—è: {{ player.name }}</strong> </p>

                        {% if player.profession_revealed or is_admin %}
                            <p>üíº <strong>–ü—Ä–æ—Ñ–µ—Å—Å–∏—è:</strong> 
                                {{ player.profession }}
                                {% if is_admin%}
                                    {% if player.profession_revealed %}
                                        <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="profession" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                    {% else %}
                                        <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="profession" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                    {% endif %}
                                {% endif %}
                            </p>
                        {% endif %}

                        {% if player.gender_revealed or is_admin %}
                            <p>üë• <strong>–ü–æ–ª:</strong> 
                                {{ player.gender }}
                                {% if is_admin%}
                                    {% if player.gender_revealed %}
                                        <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="gender" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                    {% else %}
                                        <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="gender" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                    {% endif %}
                                {% endif %}
                            </p>
                        {% endif %}

                        {% if player.age_revealed or is_admin %}
                            <p>üß∏ <strong>–í–æ–∑—Ä–∞—Å—Ç:</strong> 
                                {{ player.age }}
                                {% if is_admin%}
                                    {% if player.age_revealed %}
                                        <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="age" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                    {% else %}
                                        <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="age" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                    {% endif %}
                                {% endif %}
                            </p>
                        {% endif %}

                        {% if player.childfree_revealed or is_admin %}
                            <p>üë∂ <strong>–î–µ—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–µ:</strong> 
                                {{ player.childfree }}
                                {% if is_admin%}
                                    {% if player.childfree_revealed %}
                                        <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="childfree" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                    {% else %}
                                        <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="childfree" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                    {% endif %}
                                {% endif %}
                            </p>
                        {% endif %}

                        {% if player.physique_revealed or is_admin %}
                            <p>üßò <strong>–¢–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ:</strong> 
                                {{ player.physique }}
                                {% if is_admin%}
                                    {% if player.physique_revealed %}
                                        <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="physique" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                    {% else %}
                                        <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="physique" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                    {% endif %}
                                {% endif %}
                            </p>
                        {% endif %}
                    </div>

                    <!-- –ó–¥–æ—Ä–æ–≤—å–µ -->
                    <div class="mb-3">
                        {% set ns = namespace(show_health=true) %}
                        {% for item in player.health_items %}
                            {% if item.revealed or is_admin %}
                                {% if ns.show_health %}
                                    <strong>–ó–¥–æ—Ä–æ–≤—å–µ:</strong>
                                    {% set ns.show_health = false %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <ul class="list-unstyled">
                            {% for item in player.health_items %}
                                {% if item.revealed or is_admin %}
                                <li>
                                    ‚ù§ {{ item.value }}
                                    {% if is_admin%}
                                        {% if item.revealed %}
                                            <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="health" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="health" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                        {% endif %}
                                    {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>

                    <!-- –ß–µ—Ä—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ -->
                    <div class="mb-3">
                        {% set ns = namespace(show_traits=true) %}
                        {% for item in player.traits_items %}
                            {% if item.revealed or is_admin %}
                                {% if ns.show_traits %}
                                    <strong>–ß–µ—Ä—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞:</strong>
                                    {% set ns.show_traits = false %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <ul class="list-unstyled">
                            {% for item in player.traits_items %}
                                {% if item.revealed or is_admin %}
                                <li>
                                    üë∫ {{ item.value }}
                                    {% if is_admin%}
                                        {% if item.revealed %}
                                            <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="traits" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="traits" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                        {% endif %}
                                    {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>

                    <!-- –§–æ–±–∏–∏ -->
                    <div class="mb-3">
                        {% set ns = namespace(show_phobias=true) %}
                        {% for item in player.phobias_items %}
                            {% if item.revealed or is_admin %}
                                {% if ns.show_phobias %}
                                    <strong>–§–æ–±–∏–∏:</strong>
                                    {% set ns.show_phobias = false %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <ul class="list-unstyled">
                            {% for item in player.phobias_items %}
                                {% if item.revealed or is_admin %}
                                <li>
                                    üëª {{ item.value }}
                                    {% if is_admin%}
                                        {% if item.revealed %}
                                            <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="phobias" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="phobias" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                        {% endif %}
                                    {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>

                    <!-- –•–æ–±–±–∏ -->
                    <div class="mb-3">
                        {% set ns = namespace(show_hobbies=true) %}
                        {% for item in player.hobbies_items %}
                            {% if item.revealed or is_admin %}
                                {% if ns.show_hobbies %}
                                    <strong>–•–æ–±–±–∏:</strong>
                                    {% set ns.show_hobbies = false %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <ul class="list-unstyled">
                            {% for item in player.hobbies_items %}
                                {% if item.revealed or is_admin %}
                                <li>
                                    üé£ {{ item.value }}
                                    {% if is_admin%}
                                        {% if item.revealed %}
                                            <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="hobbies" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="hobbies" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                        {% endif %}
                                    {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>

                    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="mb-3">
                        {% set ns = namespace(show_additional_info=true) %}
                        {% for item in player.additional_info_items %}
                            {% if item.revealed or is_admin %}
                                {% if ns.show_additional_info %}
                                    <strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong>
                                    {% set ns.show_additional_info = false %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <ul class="list-unstyled">
                            {% for item in player.additional_info_items %}
                                {% if item.revealed or is_admin %}
                                <li>
                                    üìù {{ item.value }}
                                    {% if is_admin%}
                                        {% if item.revealed %}
                                            <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="additional_info" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="additional_info" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                        {% endif %}
                                    {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>

                    <!-- –ë–∞–≥–∞–∂ -->
                    <div class="mb-3">
                        {% set ns = namespace(show_baggage=true) %}
                        {% for item in player.baggage_items %}
                            {% if item.revealed or is_admin %}
                                {% if ns.show_baggage %}
                                    <strong>–ë–∞–≥–∞–∂:</strong>
                                    {% set ns.show_baggage = false %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <ul class="list-unstyled">
                            {% for item in player.baggage_items %}
                                {% if item.revealed or is_admin %}
                                <li>
                                    üì¶ {{ item.value }}
                                    {% if is_admin%}
                                        {% if item.revealed %}
                                            <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="baggage" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="baggage" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                        {% endif %}
                                    {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                    
                    <!-- –ö–∞—Ä—Ç—ã –¥–µ–π—Å—Ç–≤–∏—è -->
                    <div class="mb-3">
                        {% set ns = namespace(show_cards=true) %}
                        {% for item in player.cards_items %}
                            {% if item.revealed or is_admin %}
                                {% if ns.show_cards %}
                                    <strong>–ö–∞—Ä—Ç—ã –¥–µ–π—Å—Ç–≤–∏—è:</strong>
                                    {% set ns.show_cards = false %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <ul class="list-unstyled">
                            {% for item in player.cards_items %}
                                {% if item.revealed or is_admin %}
                                <li>
                                    üÉè –ö–∞—Ä—Ç–∞ {{ loop.index }}: {{ item.value }}
                                    {% if is_admin%}
                                        {% if item.revealed %}
                                            <button class="btn btn-sm btn-outline-danger reveal-btn" data-field="cards" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–ó–∞–∫—Ä—ã—Ç—å</button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-primary reveal-btn" data-field="cards" data-index="{{ loop.index0 }}" data-player="{{ player.id }}">–û—Ç–∫—Ä—ã—Ç—å</button>
                                        {% endif %}
                                    {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ö–Ω–æ–ø–∫–∞ "–æ—Ç–∫—Ä—ã—Ç—å"
    document.querySelectorAll('.reveal-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const playerId = this.dataset.player;
            const field = this.dataset.field;
            const index = this.dataset.index;

            fetch('/api/reveal', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    player_id: playerId,
                    field: field,
                    index: index
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            });
        });
    });
});
</script>
{% endblock %}